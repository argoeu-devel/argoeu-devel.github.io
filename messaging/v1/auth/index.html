<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Authentication & Authorization - AMS documentation [V1]</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Authentication & Authorization";
    var mkdocs_page_input_path = "auth.md";
    var mkdocs_page_url = "/auth/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> AMS documentation [V1]</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">Basic Information</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../overview/">Overview and Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../msg_backend/">Messaging Backend - Apache Kafka</a>
                </li>
                <li class="">
                    
    <a class="" href="../msg_flow/">Messaging API flow</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Authentication & Authorization</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#security-and-privacy-considerations">Security and privacy considerations</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#user-authentication">User Authentication</a></li>
        
            <li><a class="toctree-l4" href="#authorization">Authorization</a></li>
        
            <li><a class="toctree-l4" href="#per-resource-authorization">Per Resource Authorization</a></li>
        
            <li><a class="toctree-l4" href="#get-list-acl-of-a-given-topic">[GET] List ACL of a given topic</a></li>
        
            <li><a class="toctree-l4" href="#post-modify-acl-of-a-given-topic">[POST] Modify ACL of a given topic</a></li>
        
            <li><a class="toctree-l4" href="#get-list-acl-of-a-given-subscription">[GET] List ACL of a given subscription</a></li>
        
            <li><a class="toctree-l4" href="#post-modify-acl-of-a-given-subscription">[POST] Modify ACL of a given subscription</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../projects_users/">Project & User management guide</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">How to Guides</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../publisher/">Publisher Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../consumer.md">Consumer Guide</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">API Messaging API</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../api_basic/">API Basic Information</a>
                </li>
                <li class="">
                    
    <a class="" href="../api_errors/">API Error Messages</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">API & References</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../api_auth/">API Authentication</a>
                </li>
                <li class="">
                    
    <a class="" href="../api_users/">API Users</a>
                </li>
                <li class="">
                    
    <a class="" href="../api_projects/">API Projects</a>
                </li>
                <li class="">
                    
    <a class="" href="../api_topics/">API Topics</a>
                </li>
                <li class="">
                    
    <a class="" href="../api_subs/">API Subscriptions</a>
                </li>
                <li class="">
                    
    <a class="" href="../api_metrics/">API Operational Metrics</a>
                </li>
                <li class="">
                    
    <a class="" href="../api_schemas/">API Schemas</a>
                </li>
                <li class="">
                    
    <a class="" href="../api_errors/">API Error Messages</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Q&A</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../qa_general_questions/">General</a>
                </li>
                <li class="">
                    
    <a class="" href="../qa_ruby/">Ruby</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">AMS documentation [V1]</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Basic Information &raquo;</li>
        
      
    
    <li>Authentication & Authorization</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ARGOeu/argo-messaging/edit/master/docs/auth.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="security-and-privacy-considerations">Security and privacy considerations</h1>
<p>Authentication is the process of determining the identity of a client, which is typically a user account. Authorization is the process of determining what permissions an authenticated identity has on a set of specified resources. In the Messaging API, there can be no authorization without authentication.</p>
<blockquote>
<p>This is an initial implementation of the user authentication and authorization. In the next versions of the ARGO Messaging service we are going to provide support for both bear and OpenID Connect tokens for the API access and it will be possible to apply ACLs at each (resource) subscriptions and topics.</p>
</blockquote>
<h2 id="user-authentication">User Authentication</h2>
<p>Authentication requires the presence of a populated “users” collection in the datastore in the adhering to the following schema:</p>
<pre><code>{
    &quot;name&quot; : &quot;john&quot;,
    &quot;email&quot; : &quot;john@doe.com&quot;,
    &quot;project&quot; : &quot;ARGO&quot;,
    &quot;token&quot; : &quot;S3CR3T&quot;,
    &quot;roles&quot; : [
        &quot;admin&quot;,
        &quot;member&quot;
    ]
}
</code></pre>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>username</td>
</tr>
<tr>
<td>email</td>
<td>User’s email</td>
</tr>
<tr>
<td>project</td>
<td>Project that the user belongs to</td>
</tr>
<tr>
<td>token</td>
<td>Secret token for authentication</td>
</tr>
<tr>
<td>roles</td>
<td>List of roles that user has. Each role definition is used in authorization (explained later)</td>
</tr>
</tbody>
</table>
<p>Each user is authenticated by adding the url parameter ?key=T0K3N in each API request</p>
<h2 id="authorization">Authorization</h2>
<p>Authorization requires the presence of a populated “roles” collection in the datastore in the adhering to the following schema:</p>
<pre><code>{
    &quot;resource&quot; : &quot;resource_name:action&quot;,
    &quot;roles&quot; : [
        &quot;admin&quot;,
        &quot;member&quot;
    ]
}
</code></pre>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource</td>
<td>Holds the name of the resource and the action on that resource in the following format: resource_name:action</td>
</tr>
<tr>
<td>roles</td>
<td>A list of roles allowed on this resource:action</td>
</tr>
</tbody>
</table>
<p>Resource_name:action must be the same with the default routes supported in the api currently and those are:</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>topics:list</td>
<td>Allow user to list all topics in a project when using  <code>GET /projects/PROJECT_A/topics</code></td>
</tr>
<tr>
<td>topics:show</td>
<td>Allow user to get information on a specific topic when using <code>GET /projects/PROJECT_A/topics/TOPIC_A</code></td>
</tr>
<tr>
<td>topics:create</td>
<td>Allow user to create a new topic when using <code>PUT /projects/PROJECT_A/topics/TOPIC_NEW</code></td>
</tr>
<tr>
<td>topics:delete</td>
<td>Allow user to delete an existing topic when using <code>DELETE /projects/PROJECT_A/topics/TOPIC_A</code></td>
</tr>
<tr>
<td>topics:publish</td>
<td>Allow user to publish messages in a topic when using <code>POST /projects/PROJECT_A/topics/TOPIC_A:publish</code></td>
</tr>
<tr>
<td>subscriptions:list</td>
<td>Allow user to list all subscriptions in a project when using <code>GET /projects/PROJECT_A/subscriptions</code></td>
</tr>
<tr>
<td>subscriptions:show</td>
<td>Allow user to get information on a specific subscription when using <code>GET /projects/PROJECT_A/subscriptions/SUB_A</code></td>
</tr>
<tr>
<td>subscriptions:create</td>
<td>Allow user to create a new subscription when using <code>PUT /projects/PROJECT_A/subscriptions/SUB_NEW</code></td>
</tr>
<tr>
<td>subscriptions:delete</td>
<td>Allow user to delete an existing subscription when using <code>DELETE /projects/PROJECT_A/subscriptions/SUB_A</code></td>
</tr>
<tr>
<td>subscriptions:pull</td>
<td>Allow user to pull messages from a subscription when using <code>POST /projects/PROJECT_A/subscriptions/SUB_A:pull</code></td>
</tr>
<tr>
<td>subscriptions:acknowledge</td>
<td>Allow user to acknowledge messages that has pulled when using <code>POST /projects/PROJECT_A/subscriptions/SUB_A:acknowledge</code></td>
</tr>
</tbody>
</table>
<h2 id="per-resource-authorization">Per Resource Authorization</h2>
<p>Messaging API provides the option to control in finer detail access on resources such as topics and subscriptions for users(clients) that are producers or subscribers. Each resource (topic/subscription) comes with an access list (ACL) that contains producers or subscribers that are eligible to use that resource (when publishing or pulling messages respectively). Users with the admin role are able to modify Access lists for topics and subscriptions on the project they belong. In order for the feature to be available Messaging API should have the config parameter <code>per_resource_auth</code> set to <code>true</code></p>
<h2 id="get-list-acl-of-a-given-topic">[GET] List ACL of a given topic</h2>
<p>Please refer to section <a href="../api_topics/#get-list-acl-of-a-given-topic">Topics:List ACL of a given topic </a>.</p>
<h2 id="post-modify-acl-of-a-given-topic">[POST] Modify ACL of a given topic</h2>
<p>Please refer to section <a href="../api_topics/#post-modify-acl-of-a-given-topic">Topics:Modify ACL of a given topic </a>.</p>
<h2 id="get-list-acl-of-a-given-subscription">[GET] List ACL of a given subscription</h2>
<p>The following request returns a list of authorized users for a given subscription</p>
<h3 id="request">Request</h3>
<p><code>GET /v1/projects/{project_name}/subscriptions/{sub_name}:acl</code></p>
<h3 id="where">Where</h3>
<ul>
<li>Project_name: Name of the project</li>
<li>sub_name: name of the subscription</li>
</ul>
<h3 id="example-request">Example request</h3>
<pre><code>curl -X POST -H &quot;Content-Type: application/json&quot;  
-d { POSTDATA } https://{URL}/v1/projects/EGI/subscriptions/monitoring:acl?key=S3CR3T&quot;`
</code></pre>

<h3 id="responses">Responses</h3>
<p>Success Response
<code>200 OK</code></p>
<pre><code>{
 &quot;authorized_users&quot;: [
  &quot;UserA&quot;,&quot;UserB&quot;
 ]
}
</code></pre>

<h3 id="errors">Errors</h3>
<p>Please refer to section <a href="../api_errors/">Errors</a> to see all possible Errors</p>
<h2 id="post-modify-acl-of-a-given-subscription">[POST] Modify ACL of a given subscription</h2>
<p>The following request Modifies the authorized users list of a given subscription</p>
<h3 id="request_1">Request</h3>
<p><code>POST /v1/projects/{project_name}/subscriptions/{sub_name}:modifyAcl</code></p>
<h3 id="where_1">Where</h3>
<ul>
<li>Project_name: Name of the project</li>
<li>sub_name: name of the subpscription</li>
</ul>
<h3 id="post-data">Post data</h3>
<pre><code>{
&quot;authorized_users&quot;: [
 &quot;UserX&quot;,&quot;UserY&quot;
]
}
</code></pre>

<h3 id="example-request_1">Example request</h3>
<pre><code>curl -H &quot;Content-Type: application/json&quot;  https://{URL}/v1/projects/EGI/subscriptions/monitoring:modifyAcl?key=S3CR3T&quot;`
</code></pre>

<h3 id="responses_1">Responses</h3>
<p>Success Response
<code>200 OK</code></p>
<h3 id="errors_1">Errors</h3>
<p>If the to-be updated ACL contains users that are non-existent in the project the API returns the following error:
<code>404 NOT_FOUND</code></p>
<pre><code>{
   &quot;error&quot;: {
      &quot;code&quot;: 404,
      &quot;message&quot;: &quot;User(s): UserFoo1,UserFoo2 do not exist&quot;,
      &quot;status&quot;: &quot;NOT_FOUND&quot;
   }
}
</code></pre>

<p>Please refer to section <a href="../api_errors/">Errors</a> to see all possible Errors</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../projects_users/" class="btn btn-neutral float-right" title="Project & User management guide">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../msg_flow/" class="btn btn-neutral" title="Messaging API flow"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright © 2014 - 2016 GRNET S.A.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ARGOeu/argo-messaging/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../msg_flow/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../projects_users/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
