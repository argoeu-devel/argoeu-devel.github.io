<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>ARGO Availability and Reliability Monitoring - Installation for cluster mode</title>
  <link rel="alternate" type="application/atom+xml" title="API Changes" href="/changes.atom" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="ARGO is a lightweight service for Service Level Monitoring designed for medium and large sized e-Infrastructures. ">
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="ARGO Availability and Reliability Monitoring" />
    <meta property="og:description" content="ARGO is a lightweight service for Service Level Monitoring designed for medium and large sized e-Infrastructures." />
    <meta property="og:url" content="http://argoeu.github.io/" />
    <meta property="og:site_name" content="ARGO Documentation" />
    <meta property="article:publisher" content="ARGO Team" />
    <meta property="og:image" content="http://argoeu.github.io/shared/images/argo-logo.png" />
  <meta name="author" content="">
  <link rel="icon" href="/shared/favicon.ico">
  <!-- Bootstrap core CSS -->
  <link href="/shared/css/bootstrap.min.css" rel="stylesheet">
  
  <link rel="stylesheet" href="/shared/css/font-awesome.min.css">
  <link rel="stylesheet" href="/shared/css/font-beba.css">

  <link href="/shared/css/custom.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body class="documentation">
  <!-- Fixed navbar -->
<nav class="navbar navbar-inverse navbar-fixed-top">
	<div class="container">
		<div class="navbar-header">
		  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
		    <span class="sr-only">Toggle navigation</span>
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span>
		  </button>
		  <a class="navbar-brand" href="/index.html"><img src='/shared/images/argo-logo.png' alt='ARGO'  /></a>
		</div>
		<div id="navbar" class="navbar-collapse collapse">
		  <ul class="nav navbar-nav navbar-right">
		    <li class="active"><a href="/index.html">Home</a></li>
		    <li><a href="/index.html#what">About</a></li>
		    <li><a href="/index.html#features">Features</a></li>
		    <li><a href="/use-cases/">Use cases</a></li>
		    <li class="dropdown">
		      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Documentation <span class="caret"></span></a>
		      <ul class="dropdown-menu" role="menu">
			<li><a href="/overview/"><em class="fa fa-file-text-o"></em>  Overview</a></li>
			<li><a href="/guides/installation/"><em class="fa fa-file-text-o"></em>  Installation</a></li>
			<li><a href="/guides/sync/"><em class="fa fa-refresh"></em> EGI Connectors</a></li>
			<li><a href="/guides/poem/"><em class="fa fa-check-square-o"></em>  Poem service</a></li>
			<li><a href="/guides/consumer/"><em class="fa fa-send-o"></em>  Consumer</a></li>
			<li><a href="/guides/messaging/"><em class="fa fa-comments-o"></em>  Messaging Service</a></li>
			<li><a href="/guides/argo-compute-engine/"><em class="fa fa-cog"></em>  Compute Engine</a></li>
			<li><a href="/guides/api/"><em class="fa fa-cogs"></em>  API </a></li>
			<li><a href="/guides/webui/"><em class="fa fa-connectdevelop"></em>  Web UI</a></li>
			<li class="divider"></li>
			<li class="dropdown-header">Developers</li>
			<li><a href="/api/v2/"><em class="fa fa-cogs"></em>  API v2 documentation </a></li>
			<li><a href="https://api-doc.argo.grnet.gr/argo-web-api/" target="_blank"><em class="fa fa-cogs"></em>  Swagger - API v2  </a></li>
			<li><a href="/messaging/v1/overview/"><em class="fa fa-cogs"></em> Messaging v1 documentation </a></li>
			<li><a href="https://api-doc.argo.grnet.gr/argo-messaging/" target="_blank"><em class="fa fa-cogs"></em> Swagger - Messaging v1</a></li>
			<li><a href="#"><em class="fa fa-github-alt"></em>  Github</a></li>
		      </ul>
		    </li>
		  </ul>
		</div><!--/.nav-collapse -->
	</div><!--container-->
</nav>

  <div class='container-fluid' >
    <div class='row'>
        <div class="col-md-2 sidebar">
                   <div class="list-group" >	
            <a class="list-group-item disabled blue" href="/overview/">Documentation</a>
          
            <a class="list-group-item" href="/overview/">Overview</a>
          
            <a class="list-group-item disabled blue" href="/guides/installation/">Installation</a>
          
            <a class="list-group-item" href="/guides/installation/"><em class="fa fa-terminal"></em> Standalone</a>
          
          	
            <a class="list-group-item active" href="/guides/installation_cluster/"><em class="fa fa-sitemap"></em> Cluster Mode</a>
          
            <a class="list-group-item disabled blue" href="/guides/egi-connectors/">Components</a>
          
            <a class="list-group-item" href="/guides/egi-connectors/"><em class="fa fa-refresh"></em> EGI Connectors</a>

          
          
            <a class="list-group-item" href="/guides/poem/"><em class="fa fa-check-square-o"></em> Poem service</a>
          
          
            <a class="list-group-item" href="/guides/consumer/"><em class="fa fa-send-o"></em> Consumer</a>
          
            
            <a class="list-group-item " href="/guides/messaging/"><em class="fa fa-comments-o"></em> Messaging Service</a>
          
          
            
            <a class="list-group-item " href="/guides/argo-compute-engine/"><em class="fa fa-cog"></em> Compute Engine</a>
          
  	  <div id='caret-data1'>
  	      
              <a class="list-group-item-level2"  href="/guides/argo-compute-engine/installation/">
            
            <em class="fa fa-cog"></em> Installation </a>
            
              <a class="list-group-item-level2"  href="/guides/argo-compute-engine/input/">
            
            <em class="fa fa-cog"></em> Input </a>
 	    
              <a class="list-group-item-level2"  href="/guides/argo-compute-engine/report-configuration/">
            
            <em class="fa fa-cog"></em> Report configurations </a>

 
 	    
              <a class="list-group-item-level2"  href="/guides/argo-compute-engine/cli-interaction/">
            
            <em class="fa fa-cog"></em> CLI </a>

 	    
              <a class="list-group-item-level2"  href="/guides/argo-compute-engine/flume_decode_interceptor/">
            
            <em class="fa fa-cog"></em> Flume Decode Interceptor</a>


	  </div>
          
            <a class="list-group-item" href="/guides/api/"> 
          
          <em class="fa fa-cogs"></em> API</a>

          
            <a class="list-group-item" href="/guides/webui/"><em class="fa fa-connectdevelop"></em> Web UI</a>
          
          </div> <!--list group-->
          <p>&nbsp;</p>

          	
          <div class="bg-info" style='background-color:#eee;'>
            <a  href="https://github.com/ARGOeu/argo-ansible" target='blank' ><em class='fa fa-github-alt' style='font-size:40px;padding-top:-10px;margin-top:-50px;color:#123f7c;'></em></a>
            <p class="text-muted" style='padding:10px;'><a  href="https://github.com/ARGOeu/argo-ansible" target='blank' >Fork the github repository and install ARGO via Ansible playbook.</a></p>
          </div>
          



        </div>
        <div class="col-md-8 main">
          	
            <h1 class="highlight">
            
              <i class='fa fa-sitemap'></i> 
            
            Installation for cluster mode</h1>
          
          <p class="lead"> This document will guide you through the cluster mode installation process.</p>
          
<h1 id="installation-distributedcluster-mode">Installation (distributed/cluster mode)</h1>

<p>This document will guide you through the installation process. The ARGO components covered include the following items:</p>

<ul>
  <li>Consumer service</li>
  <li>Connectors</li>
  <li>Compute Engine</li>
  <li>Web API service</li>
  <li>Web UI service</li>
</ul>

<p>For a production scale environment we propose three VMs and a Hadoop cluster (distributed version). The proposed setup in this case is the following:</p>

<p><strong>Node 1 (Consumer service, Connectors and Compute Engine/Hadoop client)</strong></p>

<ul>
  <li>CentOS 6.x</li>
  <li>1 CPU</li>
  <li>2GB RAM</li>
  <li>100 GB Disk</li>
</ul>

<p><strong>Node 2 (Datastore and Web API services)</strong></p>

<ul>
  <li>CentOS 6.x</li>
  <li>4 CPUs</li>
  <li>8GB RAM</li>
  <li>60 GB Disk</li>
</ul>

<p><strong>Node 3 (Web UI service)</strong></p>

<ul>
  <li>CentOS 7.x</li>
  <li>4 CPUs</li>
  <li>4GB RAM</li>
  <li>40 GB Disk</li>
</ul>

<p>For this configuration of resources one is stronly encouraged to use the Ansible based deployment roles available on <a href="https://github.com/ARGOeu/argo-ansible">github</a>. The documentation steps provided therein are sufficient in case you choose to use the provided Ansible roles for deployment.</p>

<p>If you are not familiar with Ansible or would rather follow the step-by-step guide continue reading. </p>

<h1 id="prerequisites">Prerequisites</h1>

<ul>
  <li>You will need RHEL 6.x or similar OS (base installation) to proceed. Note that the following instructions have been tested against CentOS 6.x OSes. For the Web UI service (Node 3) an RHEL 7.x or similar OS (base installation) is required. </li>
  <li>Make sure that on all hosts an ntp client service is configured properly. </li>
  <li>Configure the OS firewall on Node 2 (Datastore and Web API services) to accept incoming <code>tcp</code> connections to ports <code>443</code> (https) and <code>27017</code> (mongod).</li>
  <li>Configure the OS firewall on Node 3 (Web UI service) to accept incoming <code>tcp</code> connections to ports <code>80</code> (http) and <code>443</code> (https).</li>
  <li>For all nodes you will need an x509 key/certificate pair in order to proceed. </li>
</ul>

<h2 id="software-repositories">Software Repositories</h2>

<h3 id="trustanchors-repository">Trustanchors repository</h3>

<p>On all nodes (Node 1, Node 2 and Node 3) create a file named <code>/etc/yum.repos.d/EGI-trustanchors.repo</code> and place within it the following contents:</p>

<pre><code>[EGI-trustanchors]
name=EGI-trustanchors
baseurl=http://repository.egi.eu/sw/production/cas/1/current/
enabled=1
gpgcheck=1
gpgkey=http://repository.egi.eu/sw/production/cas/1/GPG-KEY-EUGridPMA-RPM-3
</code></pre>

<h3 id="epel-repository">EPEL repository</h3>

<p>On Node 1 and Node 2 install (as root user) the <code>epel-release</code> package via yum:</p>

<pre><code># yum install epel-release
</code></pre>

<p>This package will configure on the host the necessary repository files under <code>/etc/yum.repos.d</code>. </p>

<h3 id="argo-repository">ARGO repository</h3>

<p>On both Node 1 and Node 2 create a new file with filename <code>/etc/yum.repos.d/argo.repo</code> and place within it the following contents:</p>

<pre><code>[argo-prod]
name=ARGO Product Repository
baseurl=http://rpm.hellasgrid.gr/mash/centos6-arstats/$basearch
enabled=0
gpgcheck=0

[argo-devel]
name=ARstats Development Repository
baseurl=http://rpm.hellasgrid.gr/mash/centos6-arstats-devel/$basearch
enabled=0
gpgcheck=0
</code></pre>

<h3 id="cloudera-v5-repository">Cloudera v5 repository</h3>

<p>On Node 1 (Sync components, Consumer service and Compute Engine/Hadoop client) you will also need to install the cloudera repository for Hadoop components (clients) to be installed. Create a new file named <code>/etc/yum.repos.d/cloudera-cdh5.repo</code> place within it the following contents:</p>

<pre><code>[cloudera-cdh5]
# Packages for Cloudera's Distribution for Hadoop, Version 5, on RedHat or CentOS 6 x86_64
name=Cloudera's Distribution for Hadoop, Version 5
baseurl=http://archive.cloudera.com/cdh5/redhat/$releasever/$basearch/cdh/5/
gpgkey = http://archive.cloudera.com/cdh5/redhat/$releasever/$basearch/cdh/RPM-GPG-KEY-cloudera
gpgcheck = 1
enabled = 1
</code></pre>

<h3 id="mongodb-v3-repository">MongoDB v3 repository</h3>

<p>On Node 2 (API and Web UI services) you will need to add the MongoDB repository. The name of the file should be <code>/etc/yum.repos.d/mongodb_3.repo</code> and its contents should be:</p>

<pre><code>[mongodb-org-3.0]
name=MongoDB Repository
baseurl=http://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.0/x86_64/
gpgcheck=0
enabled=1
</code></pre>

<h1 id="packages">Packages</h1>

<h2 id="node-1-consumer-service-connectors-and-compute-engine">Node 1 (Consumer service, Connectors and Compute Engine)</h2>

<p>Install the <code>ca-policy-egi-core</code> meta-rpm with the following command:</p>

<pre><code># yum install ca-policy-egi-core
</code></pre>

<p>Place the key/certificate pair under the <code>/etc/grid-security/</code> folder with the following names and permissions:</p>

<ul>
  <li>Key file: <code>/etc/grid-security/hostkey.pem</code> and permissions: 0400</li>
  <li>Certificate file: <code>/etc/grid-security/hostcert.pem</code> and permissions: 0644</li>
</ul>

<h3 id="sync-components-and-consumer-service">Sync Components and Consumer Service</h3>

<p>Next, as root user install the following packages via yum and pip:</p>

<pre><code># yum install python-pip
# pip install --upgrade pymongo
# yum install avro --enablerepo=argo-prod
# yum install argo-egi-consumer --enablerepo=argo-prod
# yum install argo-egi-connectors --enablerepo=argo-prod
</code></pre>

<p>The argo-egi-connectors package installs components needed for fetching complimentary to the Compute Engine data from sources of truth (i.e. GOCDB service, POEM service etc). By default the connectors are configured to fetch this information on a daily basis. For configuration details of the connectors visit <a href="/guides/egi-connectors/">this</a> page. </p>

<p>The argo-egi-consumer service can be configured to connect to one or more message brokers. By default the configuration will connect to <code>mq.afroditi.hellasgrid.gr</code> and <code>mq.cro-ngi.hr</code>. </p>

<p>This configuration (having the consumer connected to two or more broker instances) is suggested as it will allow the consumer service to cycle to the next broker in the case the one it is connected to fails for any reason. For further configuration details of the consumer service please refer <a href="/guides/consumer/">here</a>. </p>

<p>After applying the necessary configurations start the consumer service and add it to appropriate run levels, so that it starts upon the next reboot. </p>

<pre><code># service argo-egi-consumer start
# chkconfig argo-egi-consumer on
</code></pre>

<h3 id="compute-engine">Compute Engine</h3>

<p>As the root user execute the following command to install the compute engine:</p>

<pre><code># yum install ar-compute --enablerepo=argo-prod
</code></pre>

<p>Edit the <code>/etc/ar-compute-engine.conf</code> configuration file and </p>

<ul>
  <li>set the value of the <code>mongo_host</code> variable to the IP of Node 2. Note that if you have an internal network available among the nodes it should be preffered to use the internal IP. </li>
  <li>set the value of the <code>mode</code> variable to <code>cluster</code> like so: <code>mode=cluster</code>
</li>
  <li>set the values of the <code>prefilter_clean</code> and <code>sync_clean</code> variables to either <code>true</code> of <code>false</code>
</li>
</ul>

<p>All configuration options are described in detail <a href="/guides/compute/compute-job-configuration/">here</a></p>

<p>Under the folder <code>/etc/cron.d/</code> place two cronjobs that will handle hourly and daily calculations. </p>

<ul>
  <li>
    <p>for the hourly caclulations edit <code>/etc/cron.d/ar_job_cycle_hourly</code> and place the following contents:</p>

    <p>55 * * * * root /usr/libexec/ar-compute/standalone/job_cycle.py -d $(/bin/date –utc  +\%Y-\%m-\%d)</p>
  </li>
  <li>
    <p>for the daily caclulations edit <code>/etc/cron.d/ar_job_cycle_daily</code> and place the following contents:</p>

    <p>0 0 * * * root /usr/libexec/ar-compute/standalone/job_cycle.py -d $(/bin/date –utc –date ‘-1 day’ +\%Y-\%m-\%d)</p>
  </li>
</ul>

<h3 id="hadoop-client">Hadoop client</h3>

<p>Configure the Node as a MapReduce and HDFS Hadoop client. </p>

<h2 id="node-2-datastore-and-web-api-services">Node 2 (Datastore and Web API services)</h2>

<p>Place the key/certificate pair under the following folders with the following names and permissions:</p>

<ul>
  <li>Key file: <code>/etc/pki/tls/private/localhost.key</code> and permissions: 0400</li>
  <li>Certificate file: <code>/etc/pki/tls/certs/localhost.crt</code> and permissions: 0644</li>
</ul>

<h3 id="datastore">Datastore</h3>

<p>Install MongoDB with the following command:</p>

<pre><code># yum install mongodb-org-server-3.0.7 mongodb-org-3.0.7
</code></pre>

<p>Edit the <code>/etc/mongod.conf</code> file and set the value of the variable <code>bindIp</code> either to <code>0.0.0.0</code> or to a specific interface (i.e. use the internal NIC in case you have an internal subnet available among the nodes in your setup). </p>

<p>To start and enable the MongoDB service use the following two commands:</p>

<pre><code># service mongod start
# chkconfig mongod on
</code></pre>

<h3 id="web-api-service">Web API service</h3>

<p>Install the ARGO web API service with the following command:</p>

<pre><code># yum install argo-web-api --enablerepo=argo-prod
</code></pre>

<p>The Web API has a single configuration file: <code>/etc/argo-web-api.conf</code>. Make sure that in the <code>[server]</code> section the variables <code>cert</code> and <code>key</code> point to the public x509 certificate and private rsa key files respectively. For further configuration options visit <a href="/guides/api">this</a> page.</p>

<p>Finally, start the service using the following command:</p>

<pre><code># start argo-web-api
</code></pre>

<h3 id="node-3-web-ui-service">Node 3 (Web UI service)</h3>

<p>Installation and configuration details for the ARGO Web UI services are available <a href="/guides/webui/">here</a>. </p>


        </div><!--col-md-8-->
        <div class="col-md-2">&nbsp;</div>
      </div><!--row-->
    </div><!--container fluid-->
    <!-- from -->
<div class="jumbotron">
    <div class="container" style='padding-left:40px;'>
      <a href='https://www.grnet.gr/en' target='blank'><img src='/shared/images/grnet_transparent.png' style='padding-left:40px;' alt='GRNET S.A - Greek Research & Technology Network' title='GRNET S.A - Greek Research & Technology Network'/></a>
      <a href='http://www.cnrs.fr/' target='blank'><img src='/shared/images/cnrs.png' style='padding-left:40px;' alt='Centre national de la recherche scientifique' title='Centre national de la recherche scientifique'/></a>
      <a href='http://www.srce.unizg.hr/en/' target='blank'><img src='/shared/images/srce.png' style='padding-left:40px;' alt='SCRE - Web stranice Sveučilišnog računskog centra' title='SCRE - Web stranice Sveučilišnog računskog centra'/></a>
      <a href='http://www.egi.eu' target='blank'><img src='/shared/images/egi2.png' style='padding-left:40px;margin-top:-20px;' alt='European Grid Infrastructure' title='European Grid Infrastructure'/></a>
    </div> <!-- /container -->
</div> <!-- jumbotron -->
<!-- from-->


  
<!--footer -->
    <footer  id="footer" class="footer">
	<div class='footer_top'>       
	<div class="row ">
       </div>
       <div class="row ">
	
        <div class=" col-md-offset-1 col-md-3">
		<p><img src='/shared/images/argo-logo.png' alt='Argo'  /></p>		
		<p>ARGO is a lightweight service for Service Level Monitoring designed for medium and large sized e-Infrastructures. </p>
   	</div>
	 <div class="col-md-offset-1 col-md-3">
		<h4>Contact Us</h4>
		<address>
 		<strong>Email</strong><br>
      <a href="mailto:argoeu-project@googlegroups.com" style='color:white;'>argoeu-project[AT]googlegroups.com</a>
		</address>
   	</div>
 	<div class="col-md-3">
		<h4>Open development </h4>
    <p> We follow an open development process. All the repositories of ARGO are hosted on Github under the ARGOeu organization.</p>
   	</div>
    <div class="col-md-1"></div>
      </div>
      </div><!--footer_top-->
      <div class="footer_bottom_holder">
	<div class="footer_bottom">
    <div class="textwidget"><span>Copyright &copy; 2014 - 2015 GRNET S.A. </span>
    </div>
  <div class="textwidget"><span>
      <a href='http://validator.w3.org/check?uri=referer' target='blank'>
        <img src='/shared/images/validated.png' alt='HTML5 - CSS3 - W3C Validated' title='HTML5 - CSS3 - W3C Validated' height="30"/>
       </a>
    </span>
  </div>
	</div>
     </div>	
    </footer>
    <a href="#" class="back-to-top" style="display: inline;">
      <i class="fa fa-arrow-circle-up"></i>
    </a>
<!--/footer -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/shared/js/jquery.min.js"></script>
    <script src="/shared/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="/shared/js/ie10-viewport-bug-workaround.js"></script>
      <script src="/shared/js/jquery.easing.1.3.js"></script>
  <script src="/shared/js/jquery.animate-enhanced.min.js"></script>
  <script src="/shared/js/jquery.superslides.min.js" type="text/javascript" charset="utf-8"></script>
  <script>
    $(function() {
    

      $('#slides').superslides({
        hashchange: false,
        play: 10000
      });

        var offset = 250;
        var duration = 300;
        jQuery(window).scroll(function() {
          if (jQuery(this).scrollTop() > offset) {
            jQuery('.back-to-top').fadeIn(duration);
          } else {
            jQuery('.back-to-top').fadeOut(duration);
          }
        });
        jQuery('.back-to-top').click(function(event) {
          event.preventDefault();
          jQuery('html, body').animate({scrollTop: 0}, duration);
          return false;
        })
      });

  </script>

</body>
</html>
